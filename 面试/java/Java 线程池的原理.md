# Java 线程池的原理

## 回答重点

线程池是一种池化技术，用于预先创建并管理一组线程，避免频繁创建和销毁线程的开销，提高性能和响应速度。

它几个关键的配置包括：核心线程数、最大线程数、空闲存活时间、工作队列、拒绝策略。

主要工作原理如下：

1. 默认情况下线程不会预创建，任务提交之后才会创建线程（不过设置 prestartAllCoreThreads 可以预创建核心线程）。
2. 当核心线程满了之后不会新建线程，而是把任务堆积到工作队列中。
3. 如果工作队列放不下了，然后才会新增线程，直至达到最大线程数。
4. 如果工作队列满了，然后也已经达到最大线程数了，这时候来任务会执行拒绝策略。
5. 如果线程空闲时间超过空闲存活时间，并且当前线程数大于核心线程数的则会销毁线程，直到线程数等于核心线程数（设置 allowCoreThreadTimeOut 为 true 可以回收核心线程，默认为 false）。

## 扩展知识

### 线程池相关参数解释

* corePoolSize：核心线程数，即线程池中始终保持的线程数量。
* maximumPoolSize：最大线程数，即线程池中允许的最大线程数量。
* keepAliveTime：线程空闲时间，超过这个时间的非核心线程会被销毁。
* workQueue：任务队列，存放待执行的任务。
* threadFactory：线程工厂，用于创建新线程。
* rejectedExecutionHandler：任务拒绝处理器，当任务无法执行时的处理策略。

### 工作队列类型

* SynchronousQueue：不存储任务，直接将任务提交给线程。
* LinkedBlockingQueue：链表结构的阻塞队列，大小无限。
* ArrayBlockingQueue：数组结构的有界阻塞队列。
* PriorityBlockingQueue：带优先级的无界阻塞队列。
