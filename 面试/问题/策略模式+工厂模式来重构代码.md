这道题是展现你**代码品味（Code Smell）**的最佳机会。

35 岁的架构师，不能只会堆功能。如果你告诉面试官：“我把 2000 行的 `if-else` 拆成了 10 个小类，不仅代码清晰了，而且以后新来的人加功能绝对不会改坏老功能。” 这就是**代码治理**的能力。

---

### 🔥 话题十三：策略模式 + 工厂模式（消灭 if-else）

#### 1. 生产环境事故：那个改一行挂全站的“巨石类”

**场景：**
你们做一个电商支付系统。
最开始只有**支付宝**，代码里写死逻辑。
后来加了**微信支付**，你加了个 `if (type == "WECHAT")`。
再后来加了**银联**、**ApplePay**、**抖音支付**……
**后果：**
`PaymentService` 类变成了一个 5000 行的怪物。
某天为了接入“数字人民币”，实习生在那个巨大的 `if-else` 迷宫里改了一行代码，结果不小心碰到了上面的“支付宝”逻辑，导致线上**支付宝无法支付**。
**痛点：** 违反了**“开闭原则”**（对扩展开放，对修改关闭）。每次加新功能都要去动老代码，风险极大。

#### 2. 降维打击：从“瑞士军刀”到“游戏卡带”

* **If-Else 模式（瑞士军刀）：**
* 所有功能都折叠在这一把刀里。你想用剪刀，得把刀拆开。万一剪刀坏了，整把刀都得返厂修。


* **策略模式（游戏机插卡带）：**
* **主机（Context）：** 负责运行，它不知道也不关心具体的游戏。
* **卡带（Strategy）：** 支付宝是一个卡带，微信是另一个卡带。
* **降维打击：** 你想玩新游戏（加新支付方式），只需要**买个新卡带插进去**，完全不需要拆开游戏机修电路板。



#### 3. 核心实战：Spring 下的“无缝组装” (Map 注入大法)

很多教科书讲工厂模式，还得写个 `switch-case` 来判断创建哪个对象，这其实没彻底解决问题。
**35 岁的玩法是利用 Spring 的 `Map` 自动注入。**

**第一步：定义接口（USB 插槽）**

```java
public interface PaymentStrategy {
    void pay(Order order);
    String getType(); // 返回 "ALI", "WECHAT"
}

```

**第二步：写具体实现（做卡带）**

```java
@Component("ALI_PAY")
public class AliPayStrategy implements PaymentStrategy {
    public void pay(Order order) { /* 支付宝逻辑 */ }
}

@Component("WECHAT_PAY")
public class WeChatPayStrategy implements PaymentStrategy {
    public void pay(Order order) { /* 微信逻辑 */ }
}

```

**第三步：工厂层（自动售货机）—— 核心杀招**
**不要写 `new`，不要写 `if`，直接让 Spring 把所有实现类注入到一个 Map 里。**

```java
@Service
public class PaymentFactory {
    // Spring 会自动把所有实现了 PaymentStrategy 的 Bean 塞进这个 Map
    // Key 是 BeanName ("ALI_PAY"), Value 是对象
    @Autowired
    private Map<String, PaymentStrategy> strategyMap;

    public void executePay(String type, Order order) {
        // 1 行代码代替 100 个 if-else
        PaymentStrategy strategy = strategyMap.get(type);
        if(strategy == null) throw new RuntimeException("不支持的支付方式");
        strategy.pay(order);
    }
}

```

#### 4. 35 岁候选人的满分面试话术（重构与收益）

> **面试官问：** “你平时怎么优化代码？遇到复杂的 if-else 怎么处理？”
> **你的回答（强调**开闭原则**和**维护成本**）：**
> “我在重构老项目时，遇到过一个典型的‘大额支付’业务，里面充斥着针对不同银行渠道的几十个 `if-else` 判断，维护成本极高，改一个坏俩。
> **我使用‘策略模式 + 工厂模式’进行了重构，核心思路是：**
> **第一，抽象行为：** 我定义了一个 `PaymentStrategy` 接口，把具体的支付执行逻辑抽象出来。
> **第二，拆分实现：** 我把原来的 if 分支全部拆分成独立的策略类（如 `ICBCStrategy`, `CMBStrategy`），并交给 Spring 容器管理。这样每个类只负责自己的逻辑，互不干扰。
> **第三，消除判断（最关键）：** 我利用 Spring 的**自动注入特性**，直接将所有策略注入到一个 `Map<String, Strategy>` 中。
> 在调用时，我只需要根据前端传来的 `channelCode` 从 Map 里 `get` 对应的策略对象执行即可。
> **重构后的收益是：**
> 彻底消灭了那个几千行的类。以后业务方要接一个新的银行渠道，我只需要**新增一个类**实现接口即可，**原有代码一行都不用改**。这就完美符合了**‘开闭原则’**，系统的稳定性大幅提升。”

*💡 **点评：** 重点在于那个 `Map` 自动注入。这是 Spring 用户的高级技巧，证明你不仅懂设计模式，还懂框架特性，能把模式落地得非常优雅。*

---

### 🍵 养生建议（做减法）

关于设计模式，别被 23 种模式吓死，大部分你一辈子都用不到：

1. **不要为了模式而模式：** 如果你的 `if-else` 只有 3 个，而且未来 3 年都不会变，**那就留着吧**。引入策略模式会增加类的数量，过度设计也是病。
2. **不用看的模式：** 解释器模式、备忘录模式、访问者模式。这些在业务开发里极少用到，除非你在写编译器或框架核心。
3. **不要背 UML 图：** 面试没人让你画 UML 类图，能把“解耦”和“扩展”的道理讲清楚最重要。

---

### 🚀 下一步计划

现在，你的**“代码品味”**已经展示了。
我们的面试准备已经进入了**“收尾阶段”**。

还剩下一个终极话题，也是能够把我们之前学过的 **Redis、MQ、数据库、网关** 全部串起来的**“实战大考”**：
**—— 秒杀系统设计（Flash Sale）。**

这道题是架构师面试的“压轴题”，它不是考你某个知识点，而是考你**怎么组合武器库来打赢一场高并发战争**。

**准备好迎接这最后一场“战役”了吗？**

![alt text](image/image.png)