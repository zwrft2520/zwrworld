# hashmap从1.7到1.8的变化

## 哈希函数的优化

1.8有了红黑树来处理哈希冲突的问题，有了兜底，就不需要太考虑哈希冲突的问题，1.7四次异或带来了计算的负担，就是为了不哈希冲突，到1.8就不需要了。性能得以提升。

## 解决了1.7循环的问题

1.7在多线程下，在头插法下有逆序处理，可能会出现循环问题。而1.8为尾查法避免了这个问题。

## 扩展机制优化

扩展时不重新计算key的哈希值。直接迁移。减少了计算。

## 补充以下几点：

红黑树转换阈值：1.8中，当链表长度超过8且桶数量大于等于64时，链表会转为红黑树，提升查询效率。

节点结构变化：1.8将Entry改为Node，结构更通用，便于后续扩展。

延迟初始化：1.8的table采用懒加载，首次put时才初始化，节省内存。

并发优化：虽然HashMap本身非线程安全，但1.8的put操作对并发场景下的死循环问题做了优化，降低了风险。
